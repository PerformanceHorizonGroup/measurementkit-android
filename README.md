![PHG Icon](http://performancehorizon.com/img/logo-on-white.svg)

# Measurement Kit Android SDK

## Overview

Measurement Kit facilitates install and event tracking from within your app, as part of Performance Horizon's performance marketing service. Using the SDK in your app in combination with the other components of Measurement Kit, and you can track a wide variety of in in-app events.

Measurement Kit consists of a tracking API, a smart banner SDK, and native SDK for iOS and Android.  Building on top of Performance Horizon's API, Measurement Kit adds the additional facilities for interacting with native apps.  Events and installs must be attributed to clicks either generated by the smart banner SDK, or by the mobile tracking API.  Regular clicks (those from the domain prf.hn) are not tracked in all scenarios.

Integration with the mobile tracking API or the smart banner SDK is required for SDK install and event tracking.

## Note on conversion display

Events and installs are tracked as conversions within the Performance Horizon Enterprise platform.  At present, the conversions generated by MMK are of a type that is hidden within the standard interface.  If you wish to view your events and installs, a conversion report can be generated by adding the conversion_meta_type=13 parameter to the conversion report, eg:

https://api.performancehorizon.com/reporting/report_advertiser/campaign/1011l45/conversion.json?start_date=2016-11-06+00%3A00%3A00&end_date=2016-12-06+00%3A00%3A00&meta_type%5Bclicks%5D=13&meta_type%5Bconversions%5D=13


## Implementation

### Installation

If you're using android studio, mobile tracking can be added to your gradle build as follows.

To your project build.gradle, ensure that the jcenter repository is available, as follows.

	buildscript {
    		repositories {
        		jcenter()
    		}

    		dependencies {
        		classpath 'com.android.tools.build:gradle:2.2.2'
    		}
	}

To your app module, add the following.

	dependencies {
	    /*
	    *
	    * All other dependencies....
	    */
	    compile 'com.performancehorizon.android:measurementkit:0.3.5'
	}

### Implementing - Advertiser

#### Initialisation
Import `com.performancehorizon.measurementkit.*` into your main Activity and initialise.

	import com.performancehorizon.measurementkit.MeasurementService;

	protected void onResume()
    	{
        	super.onResume();

        	MeasurementService.sharedInstance().initialise(this.getApplicationContext(), this.getIntent(), "phg_advertiser_id", "phg_campaign_id");

    	}

You will receive your unique Performance Horizon Advertiser ID and Campaign ID when you are registered within the PHG platform. It is important to note that an Advertiser account can have multiple campaigns.

##### Google Play Install Referrer
The Google Play Store offers a method for ensuring optimal tracking accuracy via its Google Install Referrer. Clicks with a destination of the google play store will have a unique mobile tracking identifier is appended to the `referrer` parameter.

On install of the App, you can enable the pass back of this referrer value through the :

	<application>
	    <receiver android:name="com.performancehorizon.mobiletracking.ReferrerTracker" android:exported="true">
	        <intent-filter>
	             <action android:name="com.android.vending.INSTALL_REFERRER" />
	        </intent-filter>
	    </receiver>
	</application>

The  SDK will collect the refererer token from the google play store in this case, and ensure accurate attribution.

If the referrer field is already in use in the links provided to publishers, please ensure that any data in it is uri query encoded so that additional data can be appended for use by Measurement Kit.  E.g. `https://play.google.com/store/apps/details?id=com.performancehorizon.exactview&referrer=advertiserdata%3Dreferrerdata%3B`

If you're already using a referrer tracker from another library (Google Analytics, for example), then you can use a composite referrer.  Google Analytics provides an example as a custom referrer tracker:
https://developers.google.com/analytics/solutions/testing-play-campaigns

#### Tracking Events
You can use events to track a variety of actions within your app. Events are represented as conversions inside the affiliate interface.

##### Event
The most basic form of event has no value associated with it. (Perhaps an in-app action on which you're not looking to reward affiliates.)

The category parameter is used to set the product conversions.

    MobileTrackingEvent event = new MobileTrackingEvent("registration-initiated");
    MobileTrackingService.trackingInstance().trackEvent(event);

##### Sale
If an event has a value you'd like to track, sales can be associated with an event as follows.

The currency parameter is a ISO 4217 currency code. (eg, USD, GBP)

	Event event = new Event(new Sale("premium upgrade", new BigDecimal(34.5)), "GBP");

	MeasurementService.trackingInstance().trackEvent(event);

#### URL Scheme configuration

In order to be opened via the appropriate intent, a app would commonly register a splash activity with an Intent filter as follows.  (This example uses a custom scheme)

    <intent-filter>
       <data android:scheme="exactview" android:host="open" />
       <action android:name="android.intent.action.VIEW" />
       <category android:name="android.intent.category.DEFAULT" />
       <category android:name="android.intent.category.BROWSABLE" />
    </intent-filter>

#### Advertising Identifier

 The advertising identifier from google play services is captured if that library is available on the device.  It is used for attribution in some scenarios.
